<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JJy | 高性能 MySQL 驾驶笔记</title>
  <link rel="stylesheet" href=" /css/main.css">
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  
  <!-- and it's easy to individually load additional languages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  
  <script>hljs.highlightAll();</script>
</head>


<body>
  <header>
  <nav>
    <ul>
        <li><a href=" /">All</a></li>
        <li><a href=" /about">@JJy</a></li>
        <li><a href=" /atom.xml">RSS</a></li>
    </ul>
</nav>

</header>

  <main class="container">
    <article>
  <header>
    <h2>高性能 MySQL 驾驶笔记</h2>
    <time datetime=" 2018-03-28" class="post-meta">2018-03-28</time>
    <p>
      
      <a class="post-link" href=" tags/mysql">mysql</a>
      
      <a class="post-link" href=" tags/中文">中文</a>
      
    </p>
  </header>
  <blockquote>
  <p>聊天群里看到有人复习 MySQL 准备面试，想起之前整理过《高性能MySQL》的笔记，倒是很适合面试前的准备</p>

  <p>内容大部分是整理自《高性能MySQL》第三版，外加少量的个人经验</p>
</blockquote>

<hr />
<h2 id="schema-tips">Schema Tips:</h2>

<p>Varchar 存储时会自动调整长度</p>

<p>MySQL 会根据 Varchar 指定的长度预分配空间，所以用尽量小的值效率会更好</p>

<p>Varchar 长度变大时会造成碎片和性能问题，MySQL 需要重新为其分配空间</p>

<p>文本类型数据可以考虑是否使用 Binary，性能会比文本好</p>

<p>关联键用 int 效率最高</p>

<p>主键小的话表也会小，所以用 int 做主键可以提升性能。可以考虑内部 int， uuid 外部的“双主键”设计</p>

<p>TimeStamp 效率更高，4 个字节，带时区信息，储存为 unix time 默认不为 NULL。DateTime 则无限制，用数字存储，时间支持到 9999 年，效率不如 TimeStamp</p>

<p>IP 应该使用整数存储，使用 MySQL 函数互相转换</p>

<p>Columns 过多会引发性能问题，因为 MySQL 服务层会负责转换引擎层的数据</p>

<h2 id="索引">索引：</h2>

<p>一般使用 B+Tree，可以控制在 log 时间内</p>

<p>单列索引性能提升有限，Mysql 使用多个单独索引会分别查询后合并，并不一定能够节省时间。</p>

<p>索引可以用来用作排序，读索引的值，非常高效</p>

<p>text 和长 varchar 只会使用前 N 个长度来索引，无法用索引排序</p>

<p>小技巧，可以使用“索引”字段加索引，达到人工控制索引的目的</p>

<p>聚簇索引，使用 B+Tree，在 innodb 中就是表，使用自增列会得到很好的 IO 性能(有序，连续)，使用 UUID 则效率低下(随机 IO，要写 Tree 的不同位置)，所以主键要使用自增 int</p>

<p>因为底层存储引擎 API 限制，Like 操作不能直接读索引返回</p>

<p>增加索引会提升查询速度，但会降低增删改操作，所以也可以考虑用缓存解决</p>

<p>InnoDB ID 自动包含在二级索引</p>

</article>

  </main>

   <footer>
  <a href="https://creativecommons.org/licenses/by-nc/3.0/deed.en_US">
    <span>
      JJy
    </span>
    
    <span>© 2024</span>
  </a>
</footer>

</body>

</html>
